---
- debug:
    msg:
      - "ansible_os_family: {{ ansible_os_family }}"
      - "inventory_hostname: {{ inventory_hostname }}"
      - "ansible_hostname: {{ ansible_hostname }}"

- name: Clone fzf repo
  git:
    repo: https://github.com/junegunn/fzf
    dest: ~/.fzf
    update: no

- name: Install fzf script
  shell: "~/.fzf/install"
  args:
    creates: "~/.fzf/bin/fzf"

- name: Set up temporary Vim directories
  file:
    path: '~/.local/share/nvim/{{ item }}'
    state: directory
  with_items: '{{ vim_tmp_dirs }}'

- name: Load work vars
  include_vars: work.yml
  when:
    ansible_os_family == 'Darwin'
    and ansible_hostname is match(work_hostname)

- name: Template dotfiles
  template:
    src={{ ansible_env.PWD }}/roles/dotfiles/templates/{{ item }}
    dest={{ ansible_env.PWD }}/roles/dotfiles/files/{{ item }}
    force=yes
  with_items: '{{ templates }}'

- name: Create common dotfiles
  file:
    src={{ ansible_env.PWD }}/roles/dotfiles/files/{{ item }}
    path=~/{{ item }}
    state=link
    force=yes
    follow=false
  with_items: '{{ common_files }}'

# os specific tasks
- name: Create Darwin symlinks
  when: ansible_os_family == "Darwin" and darwin_files is defined
  file:
    src={{ ansible_env.PWD }}/roles/dotfiles/files/{{ item }}
    path=~/{{ item }}
    state=link
    force=yes
    follow=false
  with_items: '{{ darwin_files }}'

- name: Create Archlinux symlinks
  when: ansible_os_family == "Archlinux" and archlinux_files is defined
  file:
    src={{ ansible_env.PWD }}/roles/dotfiles/files/{{ item }}
    path=~/{{ item }}
    state=link
    force=yes
    follow=false
  with_items: '{{ archlinux_files }}'
